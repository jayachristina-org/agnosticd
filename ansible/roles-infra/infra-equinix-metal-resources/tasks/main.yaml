---
- when: ACTION == 'provision'
  block:
#    - include_tasks: create_project.yaml
    - set_fact:
        equinix_metal_project_id: "4bd2d79e-e0a0-4aaf-98df-f4b6e0bf9658"
    - include_tasks: ssh_key.yaml
    - include_tasks: create_instances.yaml

- when: ACTION == 'destroy'
  block:
    - include_tasks: lookup_project.yaml
    - when: equinix_metal_project_id is defined
      block:
        - include_tasks: delete_instances.yaml
        - include_tasks: delete_project.yaml

- when: ACTION in ['status', 'start', 'stop']
  block:
    - include_tasks: lookup_project.yaml
    - when: equinix_metal_project_id is defined
      block:
        - include_tasks: "{{ ACTION }}_instances.yaml"
