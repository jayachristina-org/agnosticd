---
- hosts: localhost
  gather_facts: false
  tasks:
    - add_host:
        hostname: citrix
        ansible_host: 192.168.3.11
        ansible_password: "{{ vdi_password }}"
        ansible_connection: winrm
        ansible_user: Administrator@win.example.com
        ansible_winrm_server_cert_validation: ignore
        ansible_winrm_transport: ntlm

- hosts: citrix
  gather_facts: false
  tasks:
    - wait_for_connection:
        delay: 60
        timeout: 600
    - win_shell: "Set-STFRoamingGateway -Name CitrixGW -GatewayURL https://citrixgw.{{ guid }}.dynamic.opentlc.com/"
